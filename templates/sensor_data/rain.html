{% extends "home_automation_base.html" %}
{% block nav %}
    <li><a href="/circuits">Sprinklers</a></li>
    <li><a href="/outside">Outside Temp/Humidity</a></li>
    <li><a href="/cellar">Cellar Temp/Humidity</a></li>
    <li class="active dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Rain<span class="caret"></span></a>
        <ul class="dropdown-menu" role="menu">
        <li {% if active_link == "season" %} class="active" {% endif %}>
            <a href="/rain/{{this_season_start_datetime|urlencode}}_season">This Rainy Season</a></li>
        <li {% if active_link == "24" %} class="active" {% endif %}>
            <a href="/rain/{{day_ago_datetime|urlencode}}_24">Last 24 hours</a></li>
        <li {% if active_link == "week" %} class="active" {% endif %}>
            <a href="/rain/{{week_ago_datetime|urlencode}}_week">Last Week</a></li>
        <li {% if active_link == "year" %} class="active" {% endif %}>
            <a href="/rain/{{year_ago_datetime|urlencode}}_year">Last Year</a></li>
        <li {% if active_link == "ytd" %} class="active" {% endif %}>
            <a href="/rain/{{year_start_datetime|urlencode}}_ytd">Year to date</a></li>
        </ul>
    </li>
{% endblock %}

{% block body %}
    {% if readings|length > 0 %}

    <script type="text/javascript">
      function drawVisualization() {
        // Create and populate the data table.
        var data = new google.visualization.DataTable();
        data.addColumn('datetime', 'When');
        data.addColumn('number', 'Rainfall');
        data.addRows([
    {% for reading in readings %} [new Date({{reading.ts.year}}, {{ reading.ts.month }} - 1, {{reading.ts.day}}, {{reading.ts.hour}}, {{reading.ts.minute}}, {{reading.ts.second}}), {{ reading.value }}],
    {% endfor %}
        ]);

        // Create and draw the visualization.
        new google.visualization.LineChart(document.getElementById('rainfall')).
            draw(data, {
                        width: 800, height: 500,
                        title: "Cumulative Rainfall",
                        vAxis: {minValue: 0},
                        hAxis: {format: 'MMM d, y'},
                       }
                );
      }
      google.setOnLoadCallback(drawVisualization);
    </script>
    {% endif %}
    <div class="page-header">
        <h2>Last rainfall was {{last_rain}}</h2>
    </div>
    Total rainfal in this duration: {{ total }} inches.
    <p/>
    <div class="row">
        <div id="rainfall" class="col-md-12"></div>
    </div>

{% endblock %}



